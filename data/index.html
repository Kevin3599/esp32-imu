<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ESP32 Draggy Performance Logger</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font:14px Arial,sans-serif;background:#667eea;color:#333;padding:10px}
.c{max-width:480px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,.3)}
h1{text-align:center;margin-bottom:20px;font-size:22px;color:#333}
.s{display:flex;justify-content:space-between;background:#f0f0f0;padding:8px 12px;border-radius:5px;margin-bottom:15px;font-size:12px}
.tabs{display:flex;margin-bottom:20px;border-radius:8px;overflow:hidden;background:#e9ecef}
.tab{flex:1;padding:10px;text-align:center;cursor:pointer;background:#e9ecef;border:none;font-size:12px;transition:all .2s}
.tab.active{background:#28a745;color:white}
.tab:hover:not(.active){background:#dee2e6}
.section{display:none}
.section.active{display:block}
.g{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:20px}
.b{padding:12px;border:2px solid #28a745;border-radius:8px;text-align:center;background:#f9fff9}
.b.gps{border-color:#007bff;background:#f8f9ff}
.b.perf{border-color:#fd7e14;background:#fff8f0}
.v{font:bold 16px monospace;color:#28a745;display:block;margin-bottom:3px}
.v.gps{color:#007bff}
.v.perf{color:#fd7e14}
.v.big{font-size:20px}
.l{font-size:10px;color:#666;text-transform:uppercase}
.cube{width:120px;height:120px;margin:20px auto;perspective:200px}
.cb{width:60px;height:60px;margin:30px auto;transform-style:preserve-3d;transition:transform .1s}
.f{position:absolute;width:60px;height:60px;border:1px solid #28a745;background:rgba(40,167,69,.1);display:flex;align-items:center;justify-content:center;font-size:10px;color:#28a745}
.f1{transform:rotateY(0deg) translateZ(30px)}
.f2{transform:rotateY(180deg) translateZ(30px)}
.f3{transform:rotateY(90deg) translateZ(30px)}
.f4{transform:rotateY(-90deg) translateZ(30px)}
.f5{transform:rotateX(90deg) translateZ(30px)}
.f6{transform:rotateX(-90deg) translateZ(30px)}
.foot{text-align:center;font-size:10px;color:#666;margin-top:15px;border-top:1px solid #eee;padding-top:10px}
.err{background:#f8d7da;color:#721c24;padding:8px;border-radius:4px;margin:8px 0;font-size:11px;display:none}
.status{padding:5px 10px;border-radius:15px;font-size:11px;margin:2px;display:inline-block}
.status.acc{background:#28a745;color:white}
.status.brk{background:#dc3545;color:white}
.status.cor{background:#ffc107;color:#000}
</style>
</head>
<body>
<div class="c">
<h1>ğŸ ESP32 Draggy</h1>
<div class="s">
<div id="st">è¿æ¥ä¸­...</div>
<div id="tm">ç­‰å¾…æ•°æ®...</div>
</div>

<div class="tabs">
<button class="tab active" onclick="showTab('imu')">IMU</button>
<button class="tab" onclick="showTab('gps')">GPS</button>
<button class="tab" onclick="showTab('perf')">æ€§èƒ½</button>
</div>

<div class="err" id="err"></div>

<!-- IMUæ•°æ®é¡µé¢ -->
<div class="section active" id="imu">
<div class="g">
<div class="b"><span class="v" id="t">--</span><div class="l">æ¸©åº¦(Â°C)</div></div>
<div class="b"><span class="v" id="g">--</span><div class="l">é‡åŠ›(m/sÂ²)</div></div>
<div class="b"><span class="v" id="r">--</span><div class="l">Roll(Â°)</div></div>
<div class="b"><span class="v" id="p">--</span><div class="l">Pitch(Â°)</div></div>
</div>
<div class="cube">
<div class="cb" id="cb">
<div class="f f1">å‰</div>
<div class="f f2">å</div>
<div class="f f3">å³</div>
<div class="f f4">å·¦</div>
<div class="f f5">ä¸Š</div>
<div class="f f6">ä¸‹</div>
</div>
</div>
</div>

<!-- GPSæ•°æ®é¡µé¢ -->
<div class="section" id="gps">
<div class="g">
<div class="b gps"><span class="v gps big" id="speed">--</span><div class="l">å½“å‰é€Ÿåº¦(km/h)</div></div>
<div class="b gps"><span class="v gps" id="maxSpeed">--</span><div class="l">æœ€é«˜é€Ÿåº¦(km/h)</div></div>
<div class="b gps"><span class="v gps" id="sats">--</span><div class="l">å«æ˜Ÿæ•°é‡</div></div>
<div class="b gps"><span class="v gps" id="gpsStatus">--</span><div class="l">GPSçŠ¶æ€</div></div>
</div>
</div>

<!-- æ€§èƒ½æ•°æ®é¡µé¢ -->
<div class="section" id="perf">
<div class="g3">
<div class="b perf"><span class="v perf" id="accelG">--</span><div class="l">åŠ é€Ÿåº¦G</div></div>
<div class="b perf"><span class="v perf" id="lateralG">--</span><div class="l">æ¨ªå‘G</div></div>
<div class="b perf"><span class="v perf" id="power">--</span><div class="l">åŠŸç‡(kW)</div></div>
</div>
<div class="g">
<div class="b perf"><span class="v perf" id="accel100">--</span><div class="l">0-100km/h(ç§’)</div></div>
<div class="b perf"><span class="v perf" id="brake100">--</span><div class="l">100-0åˆ¶åŠ¨(ç§’)</div></div>
</div>
<div class="g3">
<div class="b perf"><span class="v perf" id="maxAccelG">--</span><div class="l">æœ€å¤§åŠ é€ŸG</div></div>
<div class="b perf"><span class="v perf" id="maxBrakeG">--</span><div class="l">æœ€å¤§åˆ¶åŠ¨G</div></div>
<div class="b perf"><span class="v perf" id="maxLateralG">--</span><div class="l">æœ€å¤§æ¨ªå‘G</div></div>
</div>
<div id="statusArea" style="margin-top:10px;text-align:center"></div>
</div>

<div class="foot">ESP32 Draggy Performance Logger v1.0</div>
</div>

<script>
let currentTab = 'imu';

function showTab(tab) {
document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
document.getElementById(tab).classList.add('active');
currentTab = tab;
}

function updateData() {
fetch('/data')
.then(r => r.json())
.then(d => {
document.getElementById('st').textContent = 'åœ¨çº¿';
document.getElementById('tm').textContent = new Date().toLocaleTimeString();
document.getElementById('err').style.display = 'none';

// IMUæ•°æ®
document.getElementById('t').textContent = d.temp;
document.getElementById('g').textContent = d.gravity;
document.getElementById('r').textContent = d.roll;
document.getElementById('p').textContent = d.pitch;

// GPSæ•°æ®
if(d.gps) {
document.getElementById('speed').textContent = d.gps.speed.toFixed(1);
document.getElementById('maxSpeed').textContent = d.gps.maxSpeed.toFixed(1);
document.getElementById('sats').textContent = d.gps.satellites;
document.getElementById('gpsStatus').textContent = d.gps.valid ? 'å·²å®šä½' : 'æœæ˜Ÿä¸­';
}

// æ€§èƒ½æ•°æ®
if(d.performance) {
document.getElementById('accelG').textContent = d.performance.accelG.toFixed(2);
document.getElementById('lateralG').textContent = d.performance.lateralG.toFixed(2);
document.getElementById('power').textContent = d.performance.power.toFixed(1);
document.getElementById('accel100').textContent = d.performance.accel0to100 > 0 ? d.performance.accel0to100.toFixed(2) : '--';
document.getElementById('brake100').textContent = d.performance.brake100to0 > 0 ? d.performance.brake100to0.toFixed(2) : '--';
document.getElementById('maxAccelG').textContent = d.performance.maxAccelG.toFixed(2);
document.getElementById('maxBrakeG').textContent = d.performance.maxBrakeG.toFixed(2);
document.getElementById('maxLateralG').textContent = d.performance.maxLateralG.toFixed(2);

// çŠ¶æ€æŒ‡ç¤º
let status = '';
if(d.performance.accelG > 0.1) status += '<span class="status acc">åŠ é€Ÿ</span>';
if(d.performance.accelG < -0.1) status += '<span class="status brk">åˆ¶åŠ¨</span>';
if(Math.abs(d.performance.lateralG) > 0.1) status += '<span class="status cor">è½¬å¼¯</span>';
document.getElementById('statusArea').innerHTML = status || '<span style="color:#666">ç¨³å®š</span>';
}

// 3Dç«‹æ–¹ä½“
document.getElementById('cb').style.transform = `rotateX(${d.pitch}deg) rotateZ(${d.roll}deg)`;
})
.catch(() => {
document.getElementById('st').textContent = 'ç¦»çº¿';
document.getElementById('err').textContent = 'è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
document.getElementById('err').style.display = 'block';
});
}

setInterval(updateData, 200);
updateData();
</script>
</body>
</html>
<div class="f f6">ä¸‹</div>
</div>
</div>
<div class="foot">å®æ—¶ç›‘æ§ | 5Hz | MPU6050</div>
</div>
<script>
let c=0,e=5,st=document.getElementById('st'),tm=document.getElementById('tm'),er=document.getElementById('err'),cb=document.getElementById('cb');
function se(m){er.textContent=m;er.style.display='block';setTimeout(()=>er.style.display='none',2000)}
function us(ok){c=ok?0:c+1;st.textContent=ok?'âœ…è¿æ¥':'âŒæ–­å¼€';st.style.color=ok?'#28a745':'#dc3545';if(ok)tm.textContent=new Date().toLocaleTimeString('zh-CN')}
function uc(r,p,y){cb.style.transform=`rotateX(${(r||0)*0.017}rad) rotateY(${(p||0)*0.017}rad) rotateZ(${(y||0)*0.017}rad)`}
function ud(){fetch('/data').then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}).then(d=>{us(1);document.getElementById('t').textContent=d.temp||'--';document.getElementById('g').textContent=d.gravity||'--';document.getElementById('r').textContent=d.roll||'--';document.getElementById('p').textContent=d.pitch||'--';uc(parseFloat(d.roll)||0,parseFloat(d.pitch)||0,parseFloat(d.yaw)||0)}).catch(x=>{console.error(x);us(0);c<=e&&se(`è¿æ¥é”™è¯¯(${c}/${e}): ${x.message}`)})}
ud();setInterval(ud,200);
</script>
</body>
</html>