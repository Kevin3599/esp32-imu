<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ESP32 Draggy Performance Logger</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font:14px Arial,sans-serif;background:#667eea;color:#333;padding:10px}
.c{max-width:480px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,.3)}
h1{text-align:center;margin-bottom:20px;font-size:22px;color:#333}
.s{display:flex;justify-content:space-between;background:#f0f0f0;padding:8px 12px;border-radius:5px;margin-bottom:15px;font-size:12px}
#st{font-weight:bold;transition:color 0.3s ease}
#tm{color:#666}
.tabs{display:flex;margin-bottom:20px;border-radius:8px;overflow:hidden;background:#e9ecef}
.tab{flex:1;padding:10px;text-align:center;cursor:pointer;background:#e9ecef;border:none;font-size:12px;transition:all .2s}
.tab.active{background:#28a745;color:white}
.tab:hover:not(.active){background:#dee2e6}
.section{display:none}
.section.active{display:block}
.g{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:20px}
.b{padding:12px;border:2px solid #28a745;border-radius:8px;text-align:center;background:#f9fff9}
.b.gps{border-color:#007bff;background:#f8f9ff}
.b.perf{border-color:#fd7e14;background:#fff8f0}
.v{font:bold 16px monospace;color:#28a745;display:block;margin-bottom:3px}
.v.gps{color:#007bff}
.v.perf{color:#fd7e14}
.v.big{font-size:20px}
.l{font-size:10px;color:#666;text-transform:uppercase}
.cube{width:120px;height:120px;margin:20px auto;perspective:200px}
.cb{width:60px;height:60px;margin:30px auto;transform-style:preserve-3d;transition:transform .1s}
.f{position:absolute;width:60px;height:60px;border:1px solid #28a745;background:rgba(40,167,69,.1);display:flex;align-items:center;justify-content:center;font-size:10px;color:#28a745}
.f1{transform:rotateY(0deg) translateZ(30px)}
.f2{transform:rotateY(180deg) translateZ(30px)}
.f3{transform:rotateY(90deg) translateZ(30px)}
.f4{transform:rotateY(-90deg) translateZ(30px)}
.f5{transform:rotateX(90deg) translateZ(30px)}
.f6{transform:rotateX(-90deg) translateZ(30px)}
.foot{text-align:center;font-size:10px;color:#666;margin-top:15px;border-top:1px solid #eee;padding-top:10px}
.err{background:#f8d7da;color:#721c24;padding:8px;border-radius:4px;margin:8px 0;font-size:11px;display:none}
.status{padding:5px 10px;border-radius:15px;font-size:11px;margin:2px;display:inline-block}
.status.acc{background:#28a745;color:white}
.status.brk{background:#dc3545;color:white}
.status.cor{background:#ffc107;color:#000}
#map{width:100%;height:300px;border-radius:8px;margin-bottom:20px}
.gps-info{background:#f8f9ff;padding:10px;border-radius:8px;margin-bottom:10px;font-size:12px}
.coord{font-family:monospace;color:#007bff}
.btn{background:#28a745;color:white;border:none;padding:8px 16px;border-radius:5px;cursor:pointer;font-size:13px;transition:background .3s}
.btn:hover{background:#218838}
.btn:active{background:#1e7e34}
</style>
</head>
<body>
<div class="c">
<h1>ESP32 Performance Logger</h1>
<div class="s">
<div id="st">连接中...</div>
<div id="tm">等待数据...</div>
</div>

<div class="tabs">
<button class="tab active" onclick="showTab('imu')">IMU</button>
<button class="tab" onclick="showTab('gps')">GPS</button>
<button class="tab" onclick="showTab('perf')">性能</button>
<button class="tab" onclick="showTab('map')">地图</button>
</div>

<div class="err" id="err"></div>

<!-- IMU数据页面 -->
<div class="section active" id="imu">
<div class="g">
<div class="b"><span class="v" id="t">--</span><div class="l">温度(°C)</div></div>
<div class="b"><span class="v" id="g">--</span><div class="l">重力(m/s²)</div></div>
<div class="b"><span class="v" id="r">--</span><div class="l">Roll(°)</div></div>
<div class="b"><span class="v" id="p">--</span><div class="l">Pitch(°)</div></div>
</div>
<div class="data-log" id="imuLog">
<div class="log-entry">
<span class="log-time">00:00:00</span>
<span class="log-data">系统启动 - IMU初始化中...</span>
</div>
</div>
</div>

<!-- GPS数据页面 -->
<div class="section" id="gps">
<div class="g">
<div class="b gps"><span class="v gps big" id="speed">--</span><div class="l">当前速度(km/h)</div></div>
<div class="b gps"><span class="v gps" id="maxSpeed">--</span><div class="l">最高速度(km/h)</div></div>
<div class="b gps"><span class="v gps" id="sats">--</span><div class="l">卫星数量</div></div>
<div class="b gps"><span class="v gps" id="hdop">--</span><div class="l">精度HDOP</div></div>
</div>
<div class="gps-info">
<div><strong>GPS状态:</strong> <span id="gpsStatus">--</span></div>
<div><strong>信号质量:</strong> <span id="signalQuality">--</span></div>
<div><strong>位置:</strong> <span class="coord" id="coords">--</span></div>
<div><strong>海拔:</strong> <span id="altitude">--</span>m | <strong>航向:</strong> <span id="course">--</span>°</div>
<div><strong>连接时间:</strong> <span id="connectTime">--</span>s | <strong>最后更新:</strong> <span id="lastUpdate">--</span>s前</div>
</div>
</div>

<!-- 性能数据页面 -->
<div class="section" id="perf">
<div class="g3">
<div class="b perf"><span class="v perf" id="accelG">--</span><div class="l">加速度G</div></div>
<div class="b perf"><span class="v perf" id="lateralG">--</span><div class="l">横向G</div></div>
<div class="b perf"><span class="v perf" id="power">--</span><div class="l">功率(kW)</div></div>
</div>
<div class="g">
<div class="b perf"><span class="v perf" id="accel100">--</span><div class="l">0-100km/h(秒)</div></div>
<div class="b perf"><span class="v perf" id="brake100">--</span><div class="l">100-0制动(秒)</div></div>
</div>
<div class="g3">
<div class="b perf"><span class="v perf" id="maxAccelG">--</span><div class="l">最大加速G</div></div>
<div class="b perf"><span class="v perf" id="maxBrakeG">--</span><div class="l">最大制动G</div></div>
<div class="b perf"><span class="v perf" id="maxLateralG">--</span><div class="l">最大横向G</div></div>
</div>
<div id="statusArea" style="margin-top:10px;text-align:center"></div>
</div>

<!-- 地图页面 -->
<div class="section" id="map-section">
<div class="gps-info" style="margin-bottom:15px;text-align:center;background:#fff3cd;border:1px solid #ffeaa7;color:#856404">
<strong id="mapStatus">地图功能说明</strong><br>
<span id="mapStatusText">需要谷歌地图API密钥才能显示地图</span><br>
<small>可在控制台输入: <code>setMapAPI('your-api-key')</code> 或点击下方简化地图</small>
</div>

<!-- 简化地图按钮和选项 -->
<div style="text-align:center;margin-bottom:15px;">
<button onclick="toggleSimpleMap()" class="btn" id="simpleMapBtn">
显示位置信息
</button>
<button onclick="openExternalMap()" class="btn" style="margin-left:10px;background:#17a2b8;">
外部地图
</button>
</div>

<!-- Google地图容器 -->
<div id="map" style="background:#f8f9fa;display:flex;align-items:center;justify-content:center;color:#666;min-height:300px;">
<div style="text-align:center">
<div>地图加载中...</div>
<div style="font-size:12px;margin-top:5px">需要谷歌地图API密钥</div>
</div>
</div>

<!-- 简化位置信息显示 -->
<div id="simpleLocationDisplay" style="display:none;margin:15px 0;padding:15px;background:#f8f9fa;border:1px solid #ddd;border-radius:5px;">
<h4 style="margin:0 0 10px 0;color:#495057;">位置详情</h4>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:14px;">
<div><strong>纬度:</strong> <span id="simpleLat">--</span></div>
<div><strong>经度:</strong> <span id="simpleLng">--</span></div>
<div><strong>海拔:</strong> <span id="simpleAlt">--</span> m</div>
<div><strong>速度:</strong> <span id="simpleSpeed">--</span> km/h</div>
<div><strong>卫星:</strong> <span id="simpleSats">--</span></div>
<div><strong>精度:</strong> <span id="simpleHDOP">--</span></div>
</div>
</div>

<div class="gps-info">
<div><strong>实时位置:</strong> <span class="coord" id="mapCoords">--</span></div>
<div><strong>实时速度:</strong> <span id="mapSpeed">--</span> km/h</div>
<div><strong>最高速度:</strong> <span id="mapMaxSpeed">--</span> km/h</div>
<div><strong>行驶方向:</strong> <span id="mapCourse">--</span>°</div>
</div>
</div>

<div class="foot">ESP32 Draggy Performance Logger v1.0</div>
</div>

<script>
let currentTab = 'imu';
let map, marker, trackPath = [];
let trackPolyline;
let lastValidPosition = null;

// 数据平滑处理 - 增强版
let smoothData = {
    speed: 0,
    accelG: 0,
    lateralG: 0,
    roll: 0,
    pitch: 0
};

let dataHistory = {
    speed: [],
    roll: [],
    pitch: []
};

const SMOOTH_FACTOR = 0.4; // 平滑系数 (0-1, 降低以提高响应速度)
const HISTORY_SIZE = 5; // 历史数据窗口大小

// 异常值检测和过滤
function filterOutliers(newValue, history, maxDiff = 5.0) {
    if (history.length === 0) return newValue;
    
    // 计算历史平均值
    const avg = history.reduce((sum, val) => sum + val, 0) / history.length;
    
    // 如果新值与平均值差距过大，视为异常值
    if (Math.abs(newValue - avg) > maxDiff) {
        return avg; // 返回平均值代替异常值
    }
    
    return newValue;
}

// 更新历史数据
function updateHistory(history, newValue) {
    history.push(newValue);
    if (history.length > HISTORY_SIZE) {
        history.shift();
    }
}

// 状态管理 - 避免重复更新
let lastConnectionStatus = '';
let lastUpdateTime = '';
let updateCounter = 0;

// 地图API密钥管理
let googleMapsAPIKey = localStorage.getItem('googleMapsAPI') || '';
let mapInitialized = false;
let simpleMapVisible = false;

// 提供给用户设置API密钥的函数
window.setMapAPI = function(apiKey) {
    googleMapsAPIKey = apiKey;
    localStorage.setItem('googleMapsAPI', apiKey);
    document.getElementById('mapStatus').innerHTML = '地图已配置';
    document.getElementById('mapStatusText').textContent = 'Google地图已启用';
    location.reload(); // 重新加载页面以加载地图
};

// 切换简化地图显示
function toggleSimpleMap() {
    const display = document.getElementById('simpleLocationDisplay');
    const btn = document.getElementById('simpleMapBtn');
    
    if (simpleMapVisible) {
        display.style.display = 'none';
        btn.innerHTML = '显示位置信息';
        simpleMapVisible = false;
    } else {
        display.style.display = 'block';
        btn.innerHTML = '隐藏位置信息';
        simpleMapVisible = true;
    }
}

// 打开外部地图
function openExternalMap() {
    const lat = lastValidPosition?.lat;
    const lng = lastValidPosition?.lng;
    
    if (lat && lng) {
        // 使用高德地图作为备选
        const url = `https://www.amap.com/search?query=${lat},${lng}&city=all&geoobj=${lng}|${lat}|${lng}|${lat}&zoom=16`;
        window.open(url, '_blank');
    } else {
        alert('GPS位置信息不可用，请等待GPS信号');
    }
}

// 数据验证函数
function isValidGPSData(gps) {
    return gps && 
           gps.valid && 
           gps.satellites >= 4 && 
           gps.hdop < 5.0 &&
           gps.speed >= 0 && gps.speed < 400; // 合理的速度范围
}

function smoothValue(current, target, factor) {
    if (isNaN(current) || isNaN(target)) return target || 0;
    return current * factor + target * (1 - factor);
}

// 更新IMU日志
function updateIMULog(roll, pitch, temp, gravity) {
    const logContainer = document.getElementById('imuLog');
    const timestamp = new Date().toLocaleTimeString();
    
    // 创建日志条目
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    
    // 状态指示器
    let status = 'ok';
    let statusText = '正常';
    
    if (Math.abs(roll) > 30 || Math.abs(pitch) > 30) {
        status = 'warning';
        statusText = '倾斜';
    }
    
    if (temp > 60 || temp < -10) {
        status = 'error';
        statusText = '温度异常';
    }
    
    logEntry.innerHTML = `
        <span class="log-time">${timestamp}</span>
        <span class="status-indicator status-${status}"></span>
        <span class="log-data">Roll:${roll}° Pitch:${pitch}° T:${temp}°C [${statusText}]</span>
    `;
    
    // 添加到日志头部
    logContainer.insertBefore(logEntry, logContainer.firstChild);
    
    // 保持最多50条记录
    while (logContainer.children.length > 50) {
        logContainer.removeChild(logContainer.lastChild);
    }
}

function showTab(tab) {
document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
if(tab === 'map') {
document.getElementById('map-section').classList.add('active');
if(!map) initMap();
} else {
document.getElementById(tab).classList.add('active');
}
currentTab = tab;
}

function initMap() {
// 创建地图实例
map = new google.maps.Map(document.getElementById('map'), {
zoom: 15,
center: { lat: 39.9042, lng: 116.4074 }, // 默认北京
mapTypeId: 'satellite'
});

// 创建标记
marker = new google.maps.Marker({
position: map.getCenter(),
map: map,
title: 'ESP32 Draggy',
icon: {
path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
scale: 6,
fillColor: '#FF0000',
fillOpacity: 0.8,
strokeWeight: 2,
strokeColor: '#FFFFFF'
}
});

// 创建轨迹线
trackPolyline = new google.maps.Polyline({
path: trackPath,
geodesic: true,
strokeColor: '#FF0000',
strokeOpacity: 1.0,
strokeWeight: 3
});
trackPolyline.setMap(map);
}

function updateMap(gpsData) {
if(!map || !isValidGPSData(gpsData)) return;

const position = {
lat: gpsData.latitude,
lng: gpsData.longitude
};

// 更新标记位置
marker.setPosition(position);

// 设置标记方向
if(gpsData.course >= 0) {
marker.setIcon({
path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
scale: 6,
fillColor: gpsData.speed > 5 ? '#00FF00' : '#FF0000',
fillOpacity: 0.8,
strokeWeight: 2,
strokeColor: '#FFFFFF',
rotation: gpsData.course
});
}

// 添加到轨迹 (只有在高精度且移动时)
if(gpsData.speed > 2 && gpsData.hdop < 3.0) {
trackPath.push(position);
if(trackPath.length > 300) trackPath.shift(); // 减少轨迹点数量
trackPolyline.setPath(trackPath);
}

// 第一次定位时居中地图
if(!lastValidPosition) {
map.setCenter(position);
map.setZoom(18);
}

lastValidPosition = position;

// 更新地图页面的GPS信息
document.getElementById('mapSpeed').textContent = gpsData.speed.toFixed(1);
document.getElementById('mapMaxSpeed').textContent = gpsData.maxSpeed.toFixed(1);
document.getElementById('mapCourse').textContent = gpsData.course.toFixed(0);

// 更新简化地图显示
if (simpleMapVisible) {
document.getElementById('simpleLat').textContent = gpsData.lat.toFixed(6);
document.getElementById('simpleLng').textContent = gpsData.lng.toFixed(6);
document.getElementById('simpleAlt').textContent = gpsData.altitude.toFixed(1);
document.getElementById('simpleSpeed').textContent = gpsData.speed.toFixed(1);
document.getElementById('simpleSats').textContent = gpsData.satellites;
document.getElementById('simpleHDOP').textContent = gpsData.hdop.toFixed(2);
}
}

function updateData() {
fetch('/data')
.then(r => r.json())
.then(d => {
// 只有状态改变时才更新显示 - 避免闪烁
const currentStatus = '在线';
if (lastConnectionStatus !== currentStatus) {
document.getElementById('st').textContent = currentStatus;
document.getElementById('st').style.color = '#28a745'; // 绿色表示在线
lastConnectionStatus = currentStatus;
}

// 减少时间更新频率 - 每5次更新一次时间
updateCounter++;
if (updateCounter % 5 === 0) {
const currentTime = new Date().toLocaleTimeString();
if (lastUpdateTime !== currentTime) {
document.getElementById('tm').textContent = currentTime;
lastUpdateTime = currentTime;
}
}

document.getElementById('err').style.display = 'none';

// 数据平滑处理 - 加入异常值过滤
if (d.gps && isValidGPSData(d.gps)) {
    // GPS速度异常值过滤
    const filteredSpeed = filterOutliers(d.gps.speed, dataHistory.speed, 2.0); // 降低异常值阈值
    updateHistory(dataHistory.speed, filteredSpeed);
    
    // 更严格的静止状态检测
    const isStationary = filteredSpeed < 2.5; // 提高到2.5km/h
    const finalSpeed = isStationary ? 0 : filteredSpeed;
    
    // 更强的滤波
    const filterFactor = isStationary ? 0.95 : (filteredSpeed < 5.0 ? 0.8 : SMOOTH_FACTOR);
    smoothData.speed = smoothValue(smoothData.speed, finalSpeed, filterFactor);
} else {
    smoothData.speed = smoothValue(smoothData.speed, 0, 0.95); // 更快归零
}

if (d.performance) {
    smoothData.accelG = smoothValue(smoothData.accelG, d.performance.accelG, SMOOTH_FACTOR);
    smoothData.lateralG = smoothValue(smoothData.lateralG, d.performance.lateralG, SMOOTH_FACTOR);
}

// 姿态角度平滑 (增强异常值过滤)
const filteredRoll = filterOutliers(d.roll, dataHistory.roll, 10.0);
const filteredPitch = filterOutliers(d.pitch, dataHistory.pitch, 10.0);
updateHistory(dataHistory.roll, filteredRoll);
updateHistory(dataHistory.pitch, filteredPitch);

// 静止状态角度死区处理
const isLowSpeed = smoothData.speed < 1.0;
const deadZone = isLowSpeed ? 3.0 : 1.0;

let finalRoll = Math.abs(filteredRoll) < deadZone ? 0 : filteredRoll;
let finalPitch = Math.abs(filteredPitch) < deadZone ? 0 : filteredPitch;

smoothData.roll = smoothValue(smoothData.roll, finalRoll, isLowSpeed ? 0.9 : 0.8);
smoothData.pitch = smoothValue(smoothData.pitch, finalPitch, isLowSpeed ? 0.9 : 0.8);

// IMU数据
document.getElementById('t').textContent = d.temp;
document.getElementById('g').textContent = d.gravity;
document.getElementById('r').textContent = Math.round(smoothData.roll);
document.getElementById('p').textContent = Math.round(smoothData.pitch);

// 更新IMU日志 - 每5次更新记录一次
if (updateCounter % 5 === 0) {
    updateIMULog(
        Math.round(smoothData.roll), 
        Math.round(smoothData.pitch), 
        Math.round(d.temp), 
        Math.round(d.gravity * 100) / 100
    );
}

// GPS数据 - 只有在数据有效时才更新显示
if(d.gps) {
if (isValidGPSData(d.gps)) {
document.getElementById('speed').textContent = smoothData.speed.toFixed(1);
document.getElementById('maxSpeed').textContent = d.gps.maxSpeed.toFixed(1);
document.getElementById('coords').textContent = `${d.gps.latitude.toFixed(6)}, ${d.gps.longitude.toFixed(6)}`;
document.getElementById('altitude').textContent = d.gps.altitude ? d.gps.altitude.toFixed(1) : '--';
document.getElementById('course').textContent = d.gps.course ? d.gps.course.toFixed(0) : '--';
document.getElementById('gpsStatus').textContent = '已定位';
document.getElementById('gpsStatus').style.color = '#28a745';

// 信号质量评估
let signalQuality = '良好';
let qualityColor = '#28a745';
if (d.gps.hdop > 3.0 || d.gps.satellites < 5) {
signalQuality = '较差';
qualityColor = '#dc3545';
} else if (d.gps.hdop > 2.0 || d.gps.satellites < 7) {
signalQuality = '一般';
qualityColor = '#ffc107';
}
document.getElementById('signalQuality').textContent = signalQuality;
document.getElementById('signalQuality').style.color = qualityColor;
} else {
document.getElementById('gpsStatus').textContent = `搜星中 (${d.gps.satellites}星)`;
document.getElementById('gpsStatus').style.color = '#ffc107';
document.getElementById('signalQuality').textContent = '搜索中';
document.getElementById('signalQuality').style.color = '#6c757d';
}
document.getElementById('sats').textContent = d.gps.satellites;
document.getElementById('hdop').textContent = d.gps.hdop ? d.gps.hdop.toFixed(2) : '--';

// 连接时间和最后更新时间
if (!window.gpsConnectTime && isValidGPSData(d.gps)) {
window.gpsConnectTime = Date.now();
}
if (window.gpsConnectTime) {
const connectTime = Math.floor((Date.now() - window.gpsConnectTime) / 1000);
document.getElementById('connectTime').textContent = connectTime;
}
document.getElementById('lastUpdate').textContent = Math.floor((Date.now() - (window.lastGPSUpdate || Date.now())) / 1000);
if (d.gps.satellites > 0) {
window.lastGPSUpdate = Date.now();
}

// 更新地图
if(currentTab === 'map' && isValidGPSData(d.gps)) {
updateMap(d.gps);
}
}

// 性能数据
if(d.performance) {
document.getElementById('accelG').textContent = smoothData.accelG.toFixed(2);
document.getElementById('lateralG').textContent = smoothData.lateralG.toFixed(2);
document.getElementById('power').textContent = d.performance.power.toFixed(1);
document.getElementById('accel100').textContent = d.performance.accel0to100 > 0 ? d.performance.accel0to100.toFixed(2) : '--';
document.getElementById('brake100').textContent = d.performance.brake100to0 > 0 ? d.performance.brake100to0.toFixed(2) : '--';
document.getElementById('maxAccelG').textContent = d.performance.maxAccelG.toFixed(2);
document.getElementById('maxBrakeG').textContent = d.performance.maxBrakeG.toFixed(2);
document.getElementById('maxLateralG').textContent = d.performance.maxLateralG.toFixed(2);

// 状态指示 (基于平滑后的数据)
let status = '';
if(d.performance.isAccelerating && Math.abs(smoothData.accelG) > 0.1) status += '<span class="status acc">加速</span>';
if(d.performance.isBraking && Math.abs(smoothData.accelG) > 0.1) status += '<span class="status brk">制动</span>';
if(d.performance.isCornering && Math.abs(smoothData.lateralG) > 0.1) status += '<span class="status cor">转弯</span>';
document.getElementById('statusArea').innerHTML = status || '<span style="color:#666">稳定</span>';
}

// 3D立方体 (使用平滑后的数据)
document.getElementById('cb').style.transform = `rotateX(${smoothData.pitch}deg) rotateZ(${smoothData.roll}deg)`;
})
.catch(err => {
console.error('数据获取失败:', err);
// 只有状态改变时才更新显示
const currentStatus = '离线';
if (lastConnectionStatus !== currentStatus) {
document.getElementById('st').textContent = currentStatus;
document.getElementById('st').style.color = '#dc3545'; // 红色表示离线
lastConnectionStatus = currentStatus;
}
document.getElementById('err').textContent = '连接失败，请检查网络';
document.getElementById('err').style.display = 'block';
});
}

// 页面加载完成后初始化
window.onload = function() {
// 提高更新频率以降低延迟
setInterval(updateData, 150); // 从300ms改为150ms，约6.7Hz更新
updateData();
};
</script>

<!-- 加载谷歌地图API -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>
</body>
</html>